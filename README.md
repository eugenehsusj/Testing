![](RackMultipart20200419-4-1ou6pp8_html_3f2573918489b78c.jpg)

# 密碼鎖

三位密碼鎖

徐士鈞 | 邏輯電路設計 | 2018/6/15

指導教授：許世玄

# Table of Contents

_**[設計啟發](#_Toc517340997)**_ _ **2** _

_**[密碼鎖使用方法介紹](#_Toc517340998)**_ _ **2** _

_**[設計計畫](#_Toc517340999)**_ _ **3** _

_**[設計過程](#_Toc517341000)**_ _ **3** _

**[記憶體區塊](#_Toc517341001)**  **4**

**[比較器](#_Toc517341002)**  **5**

**[控制裝置](#_Toc517341003)**  **5**

**[輸出裝置](#_Toc517341004)**  **6**

_**[成品展示](#_Toc517341005)**_ _ **6** _

_**[Reflection 8](#_Toc517341006)**_

_**[Reference 8](#_Toc517341007)**_

_**[展示電路](#_Toc517341008)**_ _ **8** _

# 設計啟發

對電路設計一直很有興趣，但是看到課本所學的知識，我暫時想不到如何運用課本知識做一個有意義的專題。在一次去健身房時，我看到置物櫃的鎖，於是讓我想到我可以做一個簡單的電子鎖，專門運用於公共場合的置物櫃。網路上電路圖一抓一大把，但我打算從頭開始設計，從最基本的Gate開始。試試看我是否能夠運用現有課本的知識設計出密碼鎖。

# 密碼鎖使用方法介紹

一個密碼鎖，想著如何使用and or xor not這幾種gate去組成去組成，腦袋瞬間空白，毫無想法。因此我決定先設計出我密碼鎖的使用方法，然後針對使用手冊去設計電路。

我的密碼鎖由4個七段顯示器，一個開關，四個按鈕組成。以下為示意圖。

![](RackMultipart20200419-4-1ou6pp8_html_edb7445c19b639ea.jpg)

開關的目的是防止電子鎖誤觸，開關關閉時，按鈕ABC無法進行輸入，按鈕open/lock在開關關閉時可以運作。

開關打開時，進入輸入介面，按鈕ABC可以進行輸入，此時的open/lock按鈕充當clear，表示將現有輸入全部歸零。

ABC按鈕按一次計數一次，密碼的輸入法就是記下按了幾次ABC。

當輸入與密碼相等時，按下open/lock來解鎖，或是不相等時按下open/lock來鎖住。

顯示器的部分，第一個顯示器代表目前是開鎖還是閉鎖，並且無視開關當前狀態。後面三個分別代表ABC三個按鈕的輸入值。當開關關閉時，顯示器ABC都不顯示值（我覺得看起來比較美觀）。開關開啟時才顯示ABC的值。

Project的材料我選擇FPGA和軟體Quartus ii來製作。因為我估計電路會很大一塊，接電線會亂七八糟且難以debug（若有ic壞掉，不太好找）。

# 設計計畫

一個密碼鎖，需要記住先前的密碼，然後比較當下輸入的密碼。因此我認為需要使用兩塊記憶體，一個比較器。還需要一個裝置，來控制當前狀態，例如目前是鎖著還是開鎖，根據開鎖閉鎖的狀態來決定ABC輸入進哪一個記憶體。我稱這個裝置為「控制區塊」。最後需要一個部分來處理輸出，稱為「輸出區塊」

總結：

1. 記憶體區塊（需要2塊能夠記住數字的裝置）
2. 比較器（比較上面兩塊記憶體的值）
3. 控制裝置（控制密碼鎖的狀態）
4. 輸出區塊

材料：

1. Altera FPGA
2. Quartus ii（windows作業系統）

#


#


#


# 設計過程

因為我的設計都是從手稿開始，以下直接擷取我最早的手稿（已經過電腦修正，原始文件很瞭亂），我會加以文字解說。

以下手稿是密碼鎖的運作過程

![](RackMultipart20200419-4-1ou6pp8_html_689f8cf15460b17e.jpg)

![](RackMultipart20200419-4-1ou6pp8_html_927d5cf983be7caa.jpg)

Initial state 代表剛開機的時候，狀態是開鎖，switch是關閉。此時storage 1跟storage 2 的初始值都是000（storage 1是加密，storage 2 是解密）

接下來打開switch，用Button ABC改變storage 1（加密）的值，然後關閉switch，按下Start 按鈕。進入閉鎖狀態。此時再次開啟switch去觸發Button ABC，已無法改變storage 1（加密）的值，只能對storage 2（解密）進行修改。

再次開啟switch，改變ABC值，直到storage 1（加密）等於storage 2（解密）再關閉switch，按下start 按鈕，進入開鎖狀態。此時恢復到initial state。

## 記憶體區塊

我需要一種記憶體，初始值為零，然後按一次加一。當按鈕按下時，訊號為high，放開時，訊號為low。我發現觸發一次按鈕，將會形成一個波。如果有辦法紀錄波出現的次數，那麼就可以完成記憶體。

這讓我回想起了binary counter，counter依賴clock的時脈來計數。若我將clock的輸入值由時脈改變為Button ABC，那麼將會符合我的需求。按一次加一，並且紀錄下來。我選用positive edge trigger的做法。這讓我可以在觸發的一瞬間即生效。我採用J-K flip-flop來做（因為有IC 7476可以使用）。

將三組這種小型記憶體，組合成一片，我稱為storage 1 and storage 2. 以下圖片是storage 的block diagram。

![](RackMultipart20200419-4-1ou6pp8_html_eea004b4259d045f.jpg)

Input 有四個，button ABC和 clear。Clear會清除ABC的值。Output 有三個，分別是A，B和C。因為訊號是4bit，所以一個Output是四條線做輸出。

## 比較器

比較器相對容易，我的記憶體屬於4bit。以下為設計圖(Block diagram)。

![](RackMultipart20200419-4-1ou6pp8_html_86d5592caa02969.jpg)

## 控制裝置

控制相對較難，控制元件有兩個輸入，第一比較器的結果，第二是Button start。然後一個輸出，輸出state代表的是當前狀態（開鎖/閉鎖）。控制裝置展示在附頁。

## 輸出裝置

輸出選擇用IC7447, 因為我有兩塊記憶體，因此一個顯示器需要切換的輸出（輸出加密/解密的數據）。在進入IC 7447前做一次處理，經過IC7447後，在做一次處理。以下顯示一顆七段顯示器的處理。

![](RackMultipart20200419-4-1ou6pp8_html_daea79895031a0d.jpg)

進入7447前，先用mux做一次處理（選擇storage 1 還是storage 2 做輸出）。出7447後，再一次處理（用於顯示橫槓）

# 成品展示

![](RackMultipart20200419-4-1ou6pp8_html_ade691ea4a28e13b.gif) ![](RackMultipart20200419-4-1ou6pp8_html_cc98d947f46e2262.gif)

圖一為剛開機時的狀態，目前狀態無法輸入。第一個七段顯示器表示目前開鎖狀態。

圖二為打開switch後開始輸入，顯示器顯示出目前的數據，現在輸入加密數字。

![](RackMultipart20200419-4-1ou6pp8_html_856f55b679cfcbc.gif) ![](RackMultipart20200419-4-1ou6pp8_html_2aae36967a607c29.gif)

接下來輸入密碼010，然後關閉switch，回到初始介面。

![](RackMultipart20200419-4-1ou6pp8_html_65158a289422ac81.gif) ![](RackMultipart20200419-4-1ou6pp8_html_784f4c8160d2bc63.jpg)

按下lock/unlock 按鈕，鎖著（此時顯示L，lock）。然後再次開啟switch準備解鎖

![](RackMultipart20200419-4-1ou6pp8_html_90f3374955c732bf.gif) ![](RackMultipart20200419-4-1ou6pp8_html_fd2f0ebaaf913f04.gif)

輸入解鎖碼後，關閉switch，再次按下lock/unlock將密碼解鎖，然後恢到初始狀態。

# Reflection

實驗過程失敗次數數不清，各種狀況都出現過，其中邏輯狀況出現的最多，特別是製作control的時候，波型圖得到的結果不是預判結果。然後瘋狂debug。

最後燒入FPGA時也出現了問題，無法燒入，燒進去後完全沒有原本的Function。檢查了半天都沒有找到原因。最後撤除所有測試用的output（例如compare，compare我有設output但是不assign 給FPGA）然後成功。

我估計是FPGA燒入時，有output沒assign導致電路出現問題，因此亂碼。

通過這次開發經驗，明白邏輯要謹慎，再簡單的步驟也需要動筆畫K-map，我有時候為了高速處理，腦子憑空想出電路圖，結果邏輯出現錯誤。

# Reference

參考資料全部源自課本，Digital Design mano

# 展示電路
